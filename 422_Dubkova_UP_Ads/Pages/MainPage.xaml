<Page x:Class="_422_Dubkova_UP_Ads.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:_422_Dubkova_UP_Ads.Pages"
      mc:Ignorable="d" 
      Title="Все объявления"
      Background="{StaticResource BackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Border Grid.Row="0" Background="{StaticResource AccentBrush}" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                    Content="← Назад"
Click="BackButton_Click"
Background="White"
FontSize="14"
Foreground="{StaticResource PrimaryTextBrush}"
BorderBrush="White"
BorderThickness="1"
Padding="12,6"
Cursor="Hand" Margin="0,10,0,4" />

                <TextBlock Grid.Column="1"
                           Text="Все объявления"
                           FontSize="22"
                           FontWeight="Bold"
                           Foreground="White"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>

                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">

                    <TextBlock Text="Общий доступ"
                               FontSize="15"
                               FontWeight="SemiBold"
                               Foreground="White"
                               VerticalAlignment="Center"
                               Margin="0,0,12,0"/>

                    <Button Content="Войти"
                            Click="LoginButton_Click"
                            Background="White"
                            Margin="0,10,0,4"
                            FontSize="14"
                            Foreground="{StaticResource PrimaryTextBrush}"
                            
                            Padding="12,4"
                            BorderThickness="0"
                            FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- FILTER BAR -->
        <Border Grid.Row="1"
                Background="{StaticResource BackgroundBrush}"
                BorderBrush="{StaticResource ControlBorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="15,10">

            <Grid Cursor="">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- SEARCH -->
                <Grid Grid.Column="0"
                 Height="36"
                 Margin="0,8,0,8"
                 VerticalAlignment="Center">

                <!-- Поле поиска -->
                 <TextBox x:Name="txtSearch"
                 FontSize="14"
                 Height="37"
                 VerticalContentAlignment="Center"
                 Background="Transparent"
                 TextChanged="txtSearch_TextChanged"
                 Margin="10,-1,0,0"/>
             

                    <!-- Подсказка -->
                    <TextBlock x:Name="txtHintSearch"
                     Text="Поиск"
                     Style="{StaticResource HintTextBlockStyle}"
                     Margin="18,0,0,0"
                     FontSize="14"
                     MouseLeftButtonUp="txtHintSearch_MouseLeftButtonUp"/>
                </Grid>

                <!-- CITY -->
                <ComboBox x:Name="cmbCity"
                          Grid.Column="1"
                          Width="140"
                          Height="35"
                          Margin="10,0,0,0"
                          SelectionChanged="Filter_SelectionChanged"
                          DisplayMemberPath="city1"/>

                <!-- CATEGORY -->
                <ComboBox x:Name="cmbCategory"
                          Grid.Column="2"
                          Width="150"
                          Height="35"
                          Margin="10,0,0,0"
                          SelectionChanged="Filter_SelectionChanged"
                          DisplayMemberPath="name"/>

                <!-- TYPE -->
                <ComboBox x:Name="cmbType"
                          Grid.Column="3"
                          Width="150"
                          Height="35"
                          Margin="10,0,0,0"
                          SelectionChanged="Filter_SelectionChanged"
                          DisplayMemberPath="type1"/>

                <!-- STATUS -->
                <ComboBox x:Name="cmbStatus"
                          Grid.Column="4"
                          Width="140"
                          Height="35"
                          Margin="10,0,0,0"
                          SelectionChanged="Filter_SelectionChanged"
                          DisplayMemberPath="status1"/>

                <Button Grid.Column="5"
                        Content="Сбросить"
                        Background="{StaticResource SecondaryTextBrush}"
                        Margin="10,0,0,0"
                        FontSize="14"
                        Click="ResetFilters_Click"/>

                <Button Grid.Column="6"
                        Content="Обновить"
                        Margin="10,0,0,0"
                        FontSize="14"
                        Click="RefreshButton_Click"/>
            </Grid>
        </Border>

        <!-- ITEMS AREA -->
        <ScrollViewer Grid.Row="2"
                      VerticalScrollBarVisibility="Auto"
                      Margin="15">

            <ItemsControl x:Name="itemsAds">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal"
                                   ItemWidth="280"
                                   ItemHeight="380"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>

                        <Border Background="White"
                                BorderBrush="{StaticResource ControlBorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="5">

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="180"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- IMAGE -->
                                <Border Grid.Row="0" Background="#F5F5F5" CornerRadius="8,8,0,0">
                                    <Image Stretch="UniformToFill">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <!-- Дефолтная картинка -->
                                                <Setter Property="Source" Value="/Images/заглушка.jpg"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasImage}" Value="True">
                                                        <Setter Property="Source" Value="{Binding ImageSource}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                </Border>

                                <!-- TITLE -->
                                <TextBlock Grid.Row="1"
                                           Text="{Binding ad_title}"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           Margin="10,10,10,5"
                                           TextWrapping="Wrap"
                                           MaxHeight="40"/>

                                <!-- DESCRIPTION -->
                                <ScrollViewer Grid.Row="2"
                                              VerticalScrollBarVisibility="Auto"
                                              Margin="10,0,10,5">

                                    <TextBlock Text="{Binding ad_description}"
                                               TextWrapping="Wrap"
                                               FontSize="12"
                                               Foreground="{StaticResource SecondaryTextBrush}"
                                               MaxHeight="80"/>
                                </ScrollViewer>

                                <!-- CITY, TYPE, PRICE -->
                                <Border Grid.Row="3"
                                        Background="#FAFAFA"
                                        Padding="10,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding City.city1}" FontSize="11" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding AdType.type1}" FontSize="10" Foreground="{StaticResource SecondaryTextBrush}"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                            <TextBlock Text="{Binding price, StringFormat={}{0} ₽}"
                                                       FontSize="14"
                                                       FontWeight="Bold"
                                                       Foreground="{StaticResource AccentBrush}"/>

                                            <TextBlock Text="{Binding ad_post_date, StringFormat=dd.MM.yyyy}"
                                                       FontSize="9"
                                                       Foreground="{StaticResource SecondaryTextBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>

                                <!-- STATUS -->
                                <Border Grid.Row="4"
                                        Background="{Binding StatusColor}"
                                        CornerRadius="0,0,8,8"
                                        Padding="6,2">

                                    <TextBlock Text="{Binding AdStatus.status1}"
                                               Foreground="White"
                                               FontSize="10"
                                               HorizontalAlignment="Center"
                                               FontWeight="SemiBold"/>
                                </Border>
                            </Grid>
                        </Border>

                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </ScrollViewer>


        <!-- STATUS BAR -->
        <StatusBar Grid.Row="3"
                   Background="{StaticResource BackgroundBrush}"
                   BorderBrush="{StaticResource ControlBorderBrush}"
                   BorderThickness="0,1,0,0">

            <StatusBarItem>
                <TextBlock x:Name="lblStatus"
                           Text="Готово"
                           FontSize="11"/>
            </StatusBarItem>

            <Separator/>

            <StatusBarItem>
                <TextBlock x:Name="lblCount"
                           Text="Найдено объявлений: 0"
                           FontSize="11"/>
            </StatusBarItem>

            <Separator/>

            <StatusBarItem>
                <TextBlock x:Name="lblFilterInfo"
                           Text="Фильтры не применены"
                           FontSize="11"
                           Foreground="{StaticResource SecondaryTextBrush}"/>
            </StatusBarItem>

        </StatusBar>

    </Grid>
</Page>
